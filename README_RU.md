# Менеджер паролей

Приложение для управления паролями с шифрованием и синхронизацией через Google Drive.

## Запуск приложения

### Важно: Google OAuth требует HTTP/HTTPS

Приложение **нельзя** открывать напрямую через `file://` протокол, если вы хотите использовать вход через Google. Google OAuth API требует запуск через HTTP/HTTPS сервер.

### Способы запуска локального сервера:

#### 1. Python 3 (рекомендуется)
```bash
# Перейдите в папку с проектом
cd путь/к/проекту

# Запустите сервер
python -m http.server 8000

# Или для Python 2:
python -m SimpleHTTPServer 8000
```

Затем откройте в браузере: `http://localhost:8000`

#### 2. Node.js (npx)
```bash
# Перейдите в папку с проектом
cd путь/к/проекту

# Запустите сервер
npx http-server -p 8000
```

Затем откройте в браузере: `http://localhost:8000`

#### 3. PHP
```bash
# Перейдите в папку с проектом
cd путь/к/проекту

# Запустите сервер
php -S localhost:8000
```

Затем откройте в браузере: `http://localhost:8000`

#### 4. VS Code Live Server
Если вы используете VS Code:
1. Установите расширение "Live Server"
2. Правой кнопкой на `index.html` ? "Open with Live Server"

## Настройка Google Drive API

Для использования входа через Google и синхронизации с Google Drive:

### Шаг 1: Создание проекта

1. Перейдите в [Google Cloud Console](https://console.cloud.google.com/)
2. Нажмите на выпадающий список проектов вверху (рядом с логотипом Google)
3. Нажмите "New Project" (Новый проект)
4. Введите название проекта (например, "Password Manager")
5. Нажмите "Create" (Создать)

### Шаг 2: Включение Google Drive API

1. В меню слева выберите **"APIs & Services"** ? **"Library"** (Библиотека)
2. В поиске введите "Google Drive API"
3. Нажмите на "Google Drive API"
4. Нажмите кнопку **"Enable"** (Включить)

### Шаг 3: Настройка экрана согласия OAuth

1. В меню слева выберите **"APIs & Services"** ? **"OAuth consent screen"** (Экран согласия OAuth)
2. Выберите **"External"** (Внешний) и нажмите "Create"
3. Заполните обязательные поля:
   - **App name** (Название приложения): например, "Менеджер паролей"
   - **User support email** (Email поддержки): ваш email
   - **Developer contact information** (Контакт разработчика): ваш email
4. Нажмите "Save and Continue" (Сохранить и продолжить)
5. На странице "Scopes" (Области видимости) нажмите "Save and Continue"
6. На странице "Test users" (Тестовые пользователи):
   - **ВАЖНО:** Нажмите **"+ ADD USERS"** (Добавить пользователей)
   - Добавьте email адреса всех пользователей, которые будут использовать приложение
   - **Важно:** Используйте тот email, с которым вы реально входите в Google аккаунт
   - Email должен быть обычным Google аккаунтом (не корпоративным/образовательным)
   - Можно добавить несколько email через запятую
   - Затем "Save and Continue"
   - **Примечание:** Только добавленные пользователи смогут войти через Google
   - **Если получаете ошибку "Ineligible accounts":**
     - Убедитесь, что используете правильный email (тот, с которым входите в Google)
     - Проверьте, что это обычный Google аккаунт (не Workspace/корпоративный)
     - Или просто опубликуйте приложение в Production (см. раздел ниже)
7. На странице "Summary" (Сводка) нажмите "Back to Dashboard" (Вернуться на панель)

### Шаг 4: Создание OAuth 2.0 Client ID

1. В меню слева выберите **"APIs & Services"** ? **"Credentials"** (Учетные данные)
2. Нажмите **"Create Credentials"** (Создать учетные данные) вверху
3. Выберите **"OAuth client ID"** (OAuth клиент ID)
4. Если появится запрос на настройку экрана согласия - выполните Шаг 3 выше
5. В форме создания:
   - **Application type** (Тип приложения): выберите **"Web application"** (Веб-приложение)
   - **Name** (Название): например, "Password Manager Web Client"
   
6. **ВАЖНО - Авторизованные источники JavaScript:**
   - В разделе **"Authorized JavaScript origins"** (Авторизованные источники JavaScript)
   - Нажмите **"+ ADD URI"** (Добавить URI)
   - Введите: `http://localhost:8000`
   - **Зачем это нужно:** Google проверяет, с какого сайта идет запрос. Это защита от кражи вашего ключа. Без этого Google откажет в доступе.
   
7. **ВАЖНО - Авторизованные URI перенаправления:**
   - В разделе **"Authorized redirect URIs"** (Авторизованные URI перенаправления)
   - Нажмите **"+ ADD URI"** (Добавить URI)
   - Введите: `http://localhost:8000`
   - **Зачем это нужно:** После входа Google должен вернуть пользователя обратно в ваше приложение. Google проверяет, что URL в списке разрешенных.
   
8. Нажмите **"Create"** (Создать)
9. **Скопируйте Client ID** (он будет показан в модальном окне) - это длинная строка вида `123456789-abcdefg.apps.googleusercontent.com`

### Шаг 5: Создание API Key

1. На странице **"Credentials"** (Учетные данные)
2. Нажмите **"Create Credentials"** (Создать учетные данные)
3. Выберите **"API key"** (API ключ)
4. Откроется окно создания API Key:
   
   **Name (Имя):**
   - Введите имя для ключа, например: "Password Manager API Key"
   - Это поле обязательное (помечено звездочкой *)
   
   **Application restrictions (Ограничения приложений):**
   - Оставьте **"None"** (Нет ограничений) - для локальной разработки это нормально
   - Или выберите **"Websites"** и добавьте `http://localhost:8000` если хотите ограничить
   
   **API restrictions (Ограничения API):**
   - Выберите **"Restrict key"** (Ограничить ключ) для безопасности
   - Нажмите "Select APIs" (Выбрать API)
   - Найдите и выберите **"Google Drive API"**
   - Нажмите "OK"
   
   **Authentication Option (Опция аутентификации):**
   - Оставьте чекбокс **"Authenticate API calls through a service account"** **не отмеченным**
   - **Важно:** Эта опция нужна только для сервисных аккаунтов и специальных API (например, Vertex AI)
   - Для нашего приложения (OAuth авторизация пользователя) эта опция **не нужна**
   
5. Нажмите **"Create"** (Создать) внизу окна
6. **Скопируйте API Key** - он будет показан в модальном окне (длинная строка вида `AIzaSy...`)
7. **ВАЖНО:** Сохраните этот ключ сразу, так как его нельзя будет посмотреть позже!

### Шаг 6: Настройка в коде

1. Откройте файл `script.js`
2. Найдите строки (примерно 42-43):
   ```javascript
   const GOOGLE_CLIENT_ID = 'YOUR_CLIENT_ID.apps.googleusercontent.com';
   const GOOGLE_API_KEY = 'YOUR_API_KEY';
   ```
3. Замените:
   - `YOUR_CLIENT_ID.apps.googleusercontent.com` на ваш **Client ID** из Шага 4
   - `YOUR_API_KEY` на ваш **API Key** из Шага 5

### Пример:

```javascript
const GOOGLE_CLIENT_ID = '123456789-abcdefghijklmnop.apps.googleusercontent.com';
const GOOGLE_API_KEY = 'AIzaSyAbCdEfGhIjKlMnOpQrStUvWxYz';
```

### Почему нужны эти настройки?

**Простыми словами:**
- Google нужно знать, какие сайты имеют право использовать ваш ключ
- Это как список доверенных друзей - Google будет работать только с сайтами из этого списка
- Без этих настроек Google откажет в доступе с ошибкой `redirect_uri_mismatch`

**Подробнее:** См. файл `GOOGLE_SETUP_EXPLAINED.md`

### Важно: Режим тестирования vs Production

После создания OAuth приложения оно находится в режиме **"Testing"** (Тестирование). Это означает:

- ? **Можно использовать:** Только пользователи, добавленные в список "Test users"
- ? **Нельзя использовать:** Другие пользователи получат ошибку `Error 403: access_denied`

#### Как сделать доступным для всех (Production):

1. В Google Cloud Console перейдите в **"APIs & Services"** ? **"OAuth consent screen"**
2. Найдите раздел **"Publishing status"** (Статус публикации)
3. Нажмите **"PUBLISH APP"** (Опубликовать приложение)
4. **ВНИМАНИЕ:** Для публикации Google может потребовать:
   - Верификацию приложения (может занять несколько дней)
   - Заполнение дополнительной информации о приложении
   - Для некоторых типов приложений может потребоваться проверка Google

#### Как узнать тип вашего Google аккаунта:

1. **Откройте ваш Google аккаунт:**
   - Перейдите на https://myaccount.google.com/
   - Войдите с вашим email

2. **Проверьте тип аккаунта:**
   - Обычный аккаунт: `@gmail.com` или `@googlemail.com`
   - Образовательный: `@edu`, `@school`, `@university` и т.д.
   - Корпоративный: `@company.com`, `@organization.com` (Workspace)

3. **Признаки образовательного/корпоративного аккаунта:**
   - В настройках аккаунта есть раздел "Organization" или "Work or school"
   - При входе видите логотип организации
   - Администратор может управлять вашим аккаунтом
   - Ограничения на некоторые функции Google

#### Рекомендация для локального использования:

**Если получаете ошибку "Ineligible accounts" при добавлении тестовых пользователей:**

1. **Проверьте email:**
   - Используйте тот email, с которым вы реально входите в Google
   - Если это образовательный/корпоративный аккаунт - это может быть причиной проблемы
   - Email должен быть полностью подтвержден

2. **Альтернатива - опубликовать в Production:**
   - Если не получается добавить тестовых пользователей, просто опубликуйте приложение
   - Для личного использования Google обычно разрешает публикацию без сложной верификации
   - Перейдите в "OAuth consent screen" ? "PUBLISH APP"
   - После публикации приложение будет доступно всем пользователям Google

**Для личного использования:**
- Если это только для вас - лучше опубликовать в Production
- Это проще, чем разбираться с тестовыми пользователями
- Google разрешает публикацию для личных приложений

**Если у вас образовательный/корпоративный аккаунт:**
- Может потребоваться разрешение администратора организации
- Или используйте обычный Google аккаунт (@gmail.com) для разработки

**Если обычный Gmail аккаунт не принимается как тестовый пользователь:**

Это может быть из-за:
- Аккаунт не полностью подтвержден (проверьте email подтверждения)
- Временная проблема Google (попробуйте позже)
- Ограничения Google на тестовые аккаунты

**Решение:**
- Просто опубликуйте приложение в Production - это проще и быстрее
- Для личного использования Google разрешает публикацию без сложной верификации
- После публикации приложение будет доступно всем, включая ваш аккаунт

## Функции

- ? Шифрование данных (AES-GCM)
- ? Множественные пользователи
- ? Управление категориями
- ? Фильтрация и поиск
- ? Импорт/экспорт (CSV/JSON)
- ? Синхронизация с Google Drive
- ? Автоматическая синхронизация каждые 30 секунд

## Использование

1. Запустите локальный сервер (см. выше)
2. Откройте `http://localhost:8000` в браузере
3. Войдите через обычный логин/пароль или через Google
4. Данные автоматически синхронизируются с Google Drive при изменениях

